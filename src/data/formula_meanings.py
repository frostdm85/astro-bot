#!/usr/bin/env python3
# coding: utf-8
"""
================================================================================
СПРАВОЧНИК РАСШИФРОВКИ ФОРМУЛ СОБЫТИЙ ПО ШЕСТОПАЛОВУ
================================================================================

Используется для генерации прогнозов на основе транзитных аспектов.
Формулы указывают на типы событий, которые могут произойти.

Формат: "X-Y" = напряжённая связь домов, "X+Y" = гармоничная связь

ОРИГИНАЛЬНЫЕ РАСШИФРОВКИ ИЗ ТАБЛИЦЫ ПОЛЬЗОВАТЕЛЯ
"""

# ==============================================================================
# ОТНОШЕНИЯ, БРАК, ЛЮБОВЬ
# ==============================================================================
FORMULAS_RELATIONSHIPS = {
    "7+4": "Хорошее время для романтики, тёплые чувства к близким",
    "7-4": "Может быть прохладно в отношениях, не лучшее время для выяснений",
    "7+5": "Лёгкое флиртовое настроение, радость от общения",
    "7-5": "Возможно лёгкое разочарование, не принимайте близко к сердцу",
    "7+10": "Хорошее время для серьёзных разговоров об отношениях",
    "7-10": "Не лучшее время для важных решений в отношениях",
    "5+10": "Хорошие новости, признание, похвала",
    "5-10": "Возможно недопонимание",
    "7-12": "Будьте внимательны в общении с партнёром",
    "7+12": "Романтическое настроение, хочется побыть вдвоём",
    "7-11": "Возможно напряжение в отношениях, дайте друг другу пространство",
    "7+11": "Хорошее время для встречи с друзьями, новых знакомств",
    "5+12": "Мысли о детях, семье",
    "5-12": "Переживания о детях",
    "1-7": "Возможны разногласия с близкими, лучше не спорить",
    "1+7": "Гармония с близкими, хорошее взаимопонимание",
    "7+8": "Успешное партнёрство, договорённость в деньгах",
    "7-8": "Не лучшее время обсуждать финансы с партнёром",
}

# ==============================================================================
# ЗДОРОВЬЕ, САМОЧУВСТВИЕ
# ==============================================================================
FORMULAS_HEALTH = {
    "6-8": "Обратите внимание на самочувствие, не перенапрягайтесь",
    "6-12": "Хорошо бы отдохнуть, восстановить силы",
    "8-12": "Прислушайтесь к организму, день для отдыха",
    "6+8": "Хорошее самочувствие, энергия есть",
    "6+12": "Хорошее время для оздоровительных процедур",
    "1-6": "Возможна усталость, не планируйте много дел",
    "1+6": "Бодрое самочувствие, активный день",
    "1-8": "Будьте осторожнее, берегите себя",
    "1-12": "Возможна хандра, уделите время себе",
}

# ==============================================================================
# КАРЬЕРА, РАБОТА, ДЕНЬГИ
# ==============================================================================
FORMULAS_CAREER = {
    "10+2": "Хорошее время для карьерных вопросов, переговоров",
    "10-2": "Не лучший день для важных рабочих вопросов",
    "10+6": "Хорошая рабочая атмосфера, дела идут",
    "10-6": "Могут быть рабочие трудности, не переживайте",
    "2+8": "Хорошее время для финансовых решений, вложений",
    "2-8": "Осторожнее с деньгами, не лучшее время для крупных трат",
    "2+11": "Хорошее время для планирования финансов и покупок",
    "10+11": "Мысли о карьере, планы на будущее",
    "2-11": "Переживания о деньгах, доходах, работе",
    # Исправленные формулы 6+X
    "6+2": "Благоприятно для рабочих дел, связанных с деньгами",
    "6-2": "Возможны сложности и вопросы на работе",
    "6+3": "Могут быть мысли о поездках, связанных с работой и не только",
    "6-3": "Хлопоты с рабочими поездками или документами",
    "6+11": "На работе всё получается, позитивный настрой, успешность в делах",
    "6-11": "Переживания о рабочих делах",
    "10-11": "Переживания о работе, карьере",
    "6+10": "Хорошее время для рабочих вопросов",
    "6-10": "Возможны рабочие недоразумения",
    "5+9": "Творческое настроение, хорошие идеи",
    "2+9": "Могут открыться хорошие возможности",
    "9+11": "Удачное время для планирования",
}

# ==============================================================================
# ФИНАНСЫ, ДЕНЬГИ
# ==============================================================================
FORMULAS_FINANCE = {
    "5+8": "Может повезти с деньгами, удачные вложения",
    "5-8": "Не рискуйте деньгами, будьте осторожны",
    "8+11": "Возможна финансовая помощь, хорошие предложения",
    "8-11": "Осторожнее с кредитами и долгами",
}

# ==============================================================================
# ДОМ, КВАРТИРА, РЕМОНТ
# ==============================================================================
FORMULAS_PROPERTY = {
    "4+8": "Хорошее время подумать о квартире, недвижимости",
    "4-8": "Могут быть хлопоты по дому",
    "4+6": "Хорошее время задуматься о ремонте, спланировать его",
    "4-6": "Возможны хлопоты с ремонтом или по хозяйству",
    "4+2": "Мысли о расходах на дом, квартиру",
    "4-2": "Переживания о бытовых расходах",
}

# ==============================================================================
# ПОЕЗДКИ
# ==============================================================================
FORMULAS_TRAVEL = {
    "4+9": "Мысли о дальней поездке, путешествии",
    "4-9": "Сомнения насчёт дальней поездки",
    "3+9": "Хорошее время для поездки или её планирования",
    "3-9": "Лучше перепроверить планы на поездку",
    "6+9": "Мысли о рабочей поездке",
    "7+9": "Возможно приятное знакомство в поездке",
    "4-12": "Переживания о поездке, мысли о поездке",
    "4+12": "Мысли о поездке, смене обстановки",
}

# ==============================================================================
# СПОРНЫЕ ВОПРОСЫ, ПЕРЕГОВОРЫ
# ==============================================================================
FORMULAS_LEGAL = {
    "9+7": "Хорошее время для договорённостей",
    "9-7": "Возможны разногласия, будьте дипломатичны",
    "9-12": "Возможны споры, будьте внимательны, чтобы не было обмана",
    "9+12": "Возможность решить любые споры",
}

# ==============================================================================
# ДЕТИ, СЕМЬЯ
# ==============================================================================
FORMULAS_CHILDREN = {
    "5+10": "Радость от детей, хорошие новости о них",
    "5-6": "Беспокойство о здоровье ребёнка",
}

# ==============================================================================
# ОСТОРОЖНОСТЬ
# ==============================================================================
FORMULAS_DANGER = {
    "7-12": "Будьте внимательны в общении, разочарование в партнёре",
    "2-12": "Осторожнее с деньгами",
    "1-8": "Будьте осторожны, не торопитесь",
    "1-12": "Возможно недопонимание с окружающими",
}

# ==============================================================================
# ТРАНСПОРТ
# ==============================================================================
FORMULAS_DAILY = {
    "3+8": "Хорошее время для вопросов с машиной, транспортом",
    "3-8": "Возможны хлопоты с машиной или транспортом",
}

# ==============================================================================
# ОБЪЕДИНЁННЫЙ СЛОВАРЬ ВСЕХ ФОРМУЛ
# ==============================================================================
ALL_FORMULAS = {}
ALL_FORMULAS.update(FORMULAS_RELATIONSHIPS)
ALL_FORMULAS.update(FORMULAS_HEALTH)
ALL_FORMULAS.update(FORMULAS_CAREER)
ALL_FORMULAS.update(FORMULAS_FINANCE)
ALL_FORMULAS.update(FORMULAS_PROPERTY)
ALL_FORMULAS.update(FORMULAS_TRAVEL)
ALL_FORMULAS.update(FORMULAS_LEGAL)
ALL_FORMULAS.update(FORMULAS_CHILDREN)
ALL_FORMULAS.update(FORMULAS_DANGER)
ALL_FORMULAS.update(FORMULAS_DAILY)


def get_formula_meaning(house1: int, house2: int, is_positive: bool) -> str:
    """
    Получить значение формулы по номерам домов и типу аспекта.

    Args:
        house1: Первый дом
        house2: Второй дом
        is_positive: True = гармоничный аспект (+), False = напряжённый (-)

    Returns:
        Описание формулы или None
    """
    sign = "+" if is_positive else "-"

    # Проверяем оба варианта порядка домов
    key1 = f"{house1}{sign}{house2}"
    key2 = f"{house2}{sign}{house1}"

    if key1 in ALL_FORMULAS:
        return ALL_FORMULAS[key1]
    if key2 in ALL_FORMULAS:
        return ALL_FORMULAS[key2]

    return None


def analyze_transit_formula(transit_houses: list, natal_houses: list, is_positive: bool) -> list:
    """
    Анализ формулы транзита — какие события может означать.

    Args:
        transit_houses: Дома транзитной планеты [дом, упр1, упр2, ...]
        natal_houses: Дома натальной планеты [дом, упр1, упр2, ...]
        is_positive: Гармоничный или напряжённый аспект

    Returns:
        Список найденных значений формул
    """
    meanings = []

    # Собираем ВСЕ дома от обеих планет
    all_houses = list(set(transit_houses + natal_houses))

    # Перебираем ВСЕ комбинации домов (включая внутри каждой планеты)
    for i, house1 in enumerate(all_houses):
        for house2 in all_houses[i+1:]:
            meaning = get_formula_meaning(house1, house2, is_positive)
            if meaning and meaning not in meanings:
                meanings.append(meaning)

    return meanings
