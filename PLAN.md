# ะัััะพะปะพะณะธัะตัะบะธะน Telegram-ะฑะพั โ ะะตัะฐะปัะฝัะน ะฟะปะฐะฝ

## 1. ะััะธัะตะบัััะฐ ะฟัะพะตะบัะฐ

```
astro-bot/
โโโ src/
โ   โโโ main.py                    # ะขะพัะบะฐ ะฒัะพะดะฐ, ัะตะณะธัััะฐัะธั handlers
โ   โโโ config.py                  # ะะพะฝัะธะณััะฐัะธั ะธะท .env
โ   โโโ database/
โ   โ   โโโ __init__.py
โ   โ   โโโ models.py              # Peewee ORM ะผะพะดะตะปะธ
โ   โโโ handlers/
โ   โ   โโโ __init__.py
โ   โ   โโโ start.py               # /start, ะณะปะฐะฒะฝะพะต ะผะตะฝั
โ   โ   โโโ forecast.py            # ะัะพะณะฝะพะทั (ะดะตะฝั/ะฟะตัะธะพะด/ะดะฐัะฐ)
โ   โ   โโโ questions.py           # ะะพะฟัะพัั ะบ AI
โ   โ   โโโ settings.py            # ะะฐัััะพะนะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั
โ   โ   โโโ support.py             # ะะพะดะดะตัะถะบะฐ
โ   โ   โโโ payment.py             # ะะฟะปะฐัะฐ YooKassa
โ   โ   โโโ admin.py               # ะะดะผะธะฝ-ะฟะฐะฝะตะปั
โ   โ   โโโ voice.py               # ะะพะปะพัะพะฒัะต ัะพะพะฑัะตะฝะธั
โ   โโโ services/
โ   โ   โโโ __init__.py
โ   โ   โโโ astro_engine.py        # Swiss Ephemeris ัะฐััััั
โ   โ   โโโ groq_client.py         # Groq API + ะฟัะพะผะฟั ะจะตััะพะฟะฐะปะพะฒะฐ
โ   โ   โโโ tts_service.py         # Edge TTS
โ   โ   โโโ whisper_service.py     # Whisper ััะฐะฝัะบัะธะฑะฐัะธั
โ   โ   โโโ yookassa_service.py    # YooKassa ะฟะปะฐัะตะถะธ
โ   โ   โโโ scheduler.py           # APScheduler ัะฐัััะปะบะธ
โ   โ   โโโ geocoder.py            # ะะตะพะบะพะดะธะฝะณ ะณะพัะพะดะพะฒ
โ   โโโ utils/
โ   โ   โโโ __init__.py
โ   โ   โโโ keyboards.py           # ะัะต ะบะปะฐะฒะธะฐัััั
โ   โ   โโโ helpers.py             # FSM, ััะธะปะธัั
โ   โ   โโโ texts.py               # ะัะต ัะตะบััั ัะพะพะฑัะตะฝะธะน
โ   โ   โโโ formatters.py          # ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ะฟัะพะณะฝะพะทะพะฒ
โ   โโโ data/
โ       โโโ shestopalov.py         # ะคะพัะผัะปั ะฟะปะฐะฝะตั ะจะตััะพะฟะฐะปะพะฒะฐ
โโโ requirements.txt
โโโ .env.example
โโโ README.md
```

---

## 2. ะะพะดะตะปะธ ะฑะฐะทั ะดะฐะฝะฝัั (Peewee ORM)

### 2.1 User (ะะพะปัะทะพะฒะฐัะตะปั)
```python
class User(BaseModel):
    telegram_id = BigIntegerField(primary_key=True)
    username = CharField(null=True)
    first_name = CharField()

    # ะะฐัะฐะปัะฝัะต ะดะฐะฝะฝัะต (ะทะฐะฟะพะปะฝัะตั ะฐะดะผะธะฝ)
    birth_date = DateField(null=True)           # ะะฐัะฐ ัะพะถะดะตะฝะธั
    birth_time = TimeField(null=True)           # ะัะตะผั ัะพะถะดะตะฝะธั
    birth_place = CharField(null=True)          # ะะฐะทะฒะฐะฝะธะต ะผะตััะฐ ัะพะถะดะตะฝะธั
    birth_lat = FloatField(null=True)           # ะจะธัะพัะฐ ัะพะถะดะตะฝะธั
    birth_lon = FloatField(null=True)           # ะะพะปะณะพัะฐ ัะพะถะดะตะฝะธั
    birth_tz = CharField(null=True)             # ะงะฐัะพะฒะพะน ะฟะพัั ัะพะถะดะตะฝะธั

    residence_place = CharField(null=True)      # ะะตััะพ ะฟัะพะถะธะฒะฐะฝะธั
    residence_lat = FloatField(null=True)
    residence_lon = FloatField(null=True)
    residence_tz = CharField(default="Europe/Moscow")

    # ะะฐัััะพะนะบะธ
    forecast_time = TimeField(default="09:00")  # ะัะตะผั ะฟะพะปััะตะฝะธั ะฟัะพะณะฝะพะทะฐ
    push_transits = BooleanField(default=False) # ะัั ะพ ะฒะฐะถะฝัั ััะฐะฝะทะธัะฐั

    # ะะธะผะธัั
    questions_today = IntegerField(default=0)   # ะะพะฟัะพัะพะฒ ัะตะณะพะดะฝั
    questions_reset_date = DateField(null=True) # ะะฐัะฐ ัะฑัะพัะฐ ัััััะธะบะฐ

    # ะกัะฐััั
    is_active = BooleanField(default=True)
    is_admin = BooleanField(default=False)
    natal_data_complete = BooleanField(default=False)  # ะะฐะฟะพะปะฝะตะฝั ะปะธ ะดะฐะฝะฝัะต

    created_at = DateTimeField(default=datetime.now)
    updated_at = DateTimeField(default=datetime.now)
```

### 2.2 Subscription (ะะพะดะฟะธัะบะฐ)
```python
class Subscription(BaseModel):
    user = ForeignKeyField(User, backref='subscriptions')

    status = CharField(default="pending")  # pending, active, expiring_soon, expired
    started_at = DateTimeField(null=True)
    expires_at = DateTimeField(null=True)

    # ะะปะฐััะถ
    payment_id = CharField(null=True)      # ID ะฟะปะฐัะตะถะฐ YooKassa
    amount = DecimalField(null=True)

    created_at = DateTimeField(default=datetime.now)
```

### 2.3 Forecast (ะััะพัะธั ะฟัะพะณะฝะพะทะพะฒ)
```python
class Forecast(BaseModel):
    user = ForeignKeyField(User, backref='forecasts')

    forecast_type = CharField()     # daily, period_3d, weekly, monthly, date
    target_date = DateField()       # ะะฐ ะบะฐะบัั ะดะฐัั
    period_end = DateField(null=True)  # ะะพะฝะตั ะฟะตัะธะพะดะฐ (ะดะปั period/weekly/monthly)

    transits_data = TextField()     # JSON ั ัะฐัััะธัะฐะฝะฝัะผะธ ััะฐะฝะทะธัะฐะผะธ
    forecast_text = TextField()     # ะกะณะตะฝะตัะธัะพะฒะฐะฝะฝัะน ัะตะบัั

    created_at = DateTimeField(default=datetime.now)
```

### 2.4 Conversation (ะะพะฝัะตะบัั ะดะธะฐะปะพะณะฐ ั AI)
```python
class Conversation(BaseModel):
    user = ForeignKeyField(User, backref='conversations')
    forecast = ForeignKeyField(Forecast, null=True)  # ะ ะบะฐะบะพะผั ะฟัะพะณะฝะพะทั

    messages = TextField()          # JSON ะผะฐััะธะฒ ัะพะพะฑัะตะฝะธะน

    created_at = DateTimeField(default=datetime.now)
    updated_at = DateTimeField(default=datetime.now)
```

### 2.5 SupportTicket (ะะฑัะฐัะตะฝะธั ะฒ ะฟะพะดะดะตัะถะบั)
```python
class SupportTicket(BaseModel):
    user = ForeignKeyField(User, backref='tickets')

    status = CharField(default="open")  # open, answered, closed

    created_at = DateTimeField(default=datetime.now)
    updated_at = DateTimeField(default=datetime.now)
```

### 2.6 SupportMessage (ะกะพะพะฑัะตะฝะธั ะฒ ัะธะบะตัะต)
```python
class SupportMessage(BaseModel):
    ticket = ForeignKeyField(SupportTicket, backref='messages')

    sender_type = CharField()       # user, admin
    sender_id = BigIntegerField()
    message_text = TextField()
    message_type = CharField(default="text")  # text, voice, photo

    created_at = DateTimeField(default=datetime.now)
```

---

## 3. ะะพะปัะทะพะฒะฐัะตะปััะบะธะน ะธะฝัะตััะตะนั (UX)

### 3.1 ะกัะฐััะพะฒัะน ัะบัะฐะฝ (ะฝะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั ะฑะตะท ะดะฐะฝะฝัั)

```
๐ ะะพะฑัะพ ะฟะพะถะฐะปะพะฒะฐัั ะฒ ะัััะพ-ะฟัะพะณะฝะพะท!

ะฏ โ ะฒะฐั ะฟะตััะพะฝะฐะปัะฝัะน ะฐัััะพะปะพะณะธัะตัะบะธะน ะฟะพะผะพัะฝะธะบ. ะะฐะถะดัะน ะดะตะฝั
ั ะฑัะดั ะฟัะธััะปะฐัั ะฒะฐะผ ะธะฝะดะธะฒะธะดัะฐะปัะฝัะน ะฟัะพะณะฝะพะท, ัะพััะฐะฒะปะตะฝะฝัะน
ะฟะพ ะผะตัะพะดั ััะฐะฝะทะธัะฝะพะณะพ ะฐะฝะฐะปะธะทะฐ ะก.ะ. ะจะตััะพะฟะฐะปะพะฒะฐ.

โณ ะะฐั ะฟัะพัะธะปั ะตัั ะฝะต ะฝะฐัััะพะตะฝ.

ะะปั ะฟะพะปััะตะฝะธั ะฟะตััะพะฝะฐะปัะฝัั ะฟัะพะณะฝะพะทะพะฒ ะฐะดะผะธะฝะธัััะฐัะพั ะดะพะปะถะตะฝ
ะฒะฝะตััะธ ะฒะฐัะธ ะฝะฐัะฐะปัะฝัะต ะดะฐะฝะฝัะต (ะดะฐัะฐ, ะฒัะตะผั ะธ ะผะตััะพ ัะพะถะดะตะฝะธั).

๐ ะกะฒัะถะธัะตัั ั ะฐัััะพะปะพะณะพะผ ะดะปั ะฝะฐัััะพะนะบะธ.

[๐จโ๐ป ะกะฒัะทะฐัััั ั ะฐัััะพะปะพะณะพะผ]
[โน๏ธ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั?]
```

**ะะฝะพะฟะบะธ:**
- `contact_astrologer` โ ะพัะบััะฒะฐะตั ัััะปะบั ะฝะฐ @username ะฐัััะพะปะพะณะฐ
- `how_it_works` โ ะฟะพะบะฐะทัะฒะฐะตั ัะฟัะฐะฒะบั

---

### 3.2 ะกัะฐััะพะฒัะน ัะบัะฐะฝ (ะดะฐะฝะฝัะต ะตััั, ะฟะพะดะฟะธัะบะฐ ะฝะตะฐะบัะธะฒะฝะฐ)

```
๐ ะัััะพ-ะฟัะพะณะฝะพะท

ะะดัะฐะฒััะฒัะนัะต, {ะธะผั}!

๐ ะะฐัะฐ ัะพะถะดะตะฝะธั: 15.03.1985, 14:30
๐ ะะตััะพ ัะพะถะดะตะฝะธั: ะะพัะบะฒะฐ
๐ ะัะพะถะธะฒะฐะฝะธะต: ะกะฐะฝะบั-ะะตัะตัะฑััะณ

โ ะะพะดะฟะธัะบะฐ ะฝะตะฐะบัะธะฒะฝะฐ

ะะปั ะฟะพะปััะตะฝะธั ะฟะตััะพะฝะฐะปัะฝัั ะฟัะพะณะฝะพะทะพะฒ ะพัะพัะผะธัะต ะฟะพะดะฟะธัะบั.

๐ฐ ะกัะพะธะผะพััั: 990 โฝ/ะผะตััั
```

**ะะฝะพะฟะบะธ:**
```
[๐ณ ะัะพัะผะธัั ะฟะพะดะฟะธัะบั]
[โ๏ธ ะะฐัััะพะนะบะธ]
[โน๏ธ ะกะฟัะฐะฒะบะฐ]
[๐จโ๐ป ะะพะดะดะตัะถะบะฐ]
```

---

### 3.3 ะะปะฐะฒะฝะพะต ะผะตะฝั (ะฐะบัะธะฒะฝะฐั ะฟะพะดะฟะธัะบะฐ) โ ะะกะะะะะะ ะญะะะะ

```
๐ ะัััะพ-ะฟัะพะณะฝะพะท

ะะดัะฐะฒััะฒัะนัะต, {ะธะผั}!

โ ะะพะดะฟะธัะบะฐ ะฐะบัะธะฒะฝะฐ ะดะพ: 15.02.2025

โ ะะพะฟัะพัะพะฒ ัะตะณะพะดะฝั: 3/10
โฐ ะกะปะตะดัััะธะน ะฟัะพะณะฝะพะท: 09:00
```

**ะะฝะพะฟะบะธ (2 ะบะพะปะพะฝะบะธ ะณะดะต ะฒะพะทะผะพะถะฝะพ):**
```
[๐ฎ ะัะพะณะฝะพะท ะฝะฐ ัะตะณะพะดะฝั]
[๐ ะัะพะณะฝะพะท ะฝะฐ ะฟะตัะธะพะด โ]    [๐ ะะฐ ะบะพะฝะบัะตัะฝัั ะดะฐัั]
[๐ฌ ะะฐะดะฐัั ะฒะพะฟัะพั (7)]
[โ๏ธ ะะฐัััะพะนะบะธ]              [โน๏ธ ะกะฟัะฐะฒะบะฐ]
[๐จโ๐ป ะะพะดะดะตัะถะบะฐ]
```

**Callback data:**
- `forecast_today` โ ะฟัะพะณะฝะพะท ะฝะฐ ัะตะณะพะดะฝั
- `forecast_period` โ ะผะตะฝั ะฒัะฑะพัะฐ ะฟะตัะธะพะดะฐ
- `forecast_date` โ ะฒัะฑะพั ะดะฐัั
- `ask_question` โ ะทะฐะดะฐัั ะฒะพะฟัะพั AI
- `settings` โ ะฝะฐัััะพะนะบะธ
- `help` โ ัะฟัะฐะฒะบะฐ
- `support` โ ะฟะพะดะดะตัะถะบะฐ

---

### 3.4 ะะตะฝั ยซะัะพะณะฝะพะท ะฝะฐ ะฟะตัะธะพะดยป

```
๐ ะัะฑะตัะธัะต ะฟะตัะธะพะด ะฟัะพะณะฝะพะทะฐ:

ะงะตะผ ะบะพัะพัะต ะฟะตัะธะพะด, ัะตะผ ะดะตัะฐะปัะฝะตะต ะฟัะพะณะฝะพะท.
```

**ะะฝะพะฟะบะธ:**
```
[๐ ะะฐ 2-3 ะดะฝั]
[๐ ะะฐ ะฝะตะดะตะปั]
[๐ ะะฐ ะผะตััั]
[โ๏ธ ะะฐะทะฐะด]
```

**Callback data:**
- `forecast_3d` โ ะฟัะพะณะฝะพะท ะฝะฐ 2-3 ะดะฝั
- `forecast_week` โ ะฝะฐ ะฝะตะดะตะปั
- `forecast_month` โ ะฝะฐ ะผะตััั
- `back_main` โ ะฝะฐะทะฐะด ะฒ ะณะปะฐะฒะฝะพะต ะผะตะฝั

---

### 3.5 ะัะฑะพั ะดะฐัั (ะบะฐะปะตะฝะดะฐัั)

```
๐ ะัะฑะตัะธัะต ะดะฐัั ะดะปั ะฟัะพะณะฝะพะทะฐ:

ะัะฟะพะปัะทัะนัะต ะบะฝะพะฟะบะธ ะดะปั ะฝะฐะฒะธะณะฐัะธะธ.
ะะพะถะฝะพ ะฒัะฑัะฐัั ะดะฐัั ะดะพ 30 ะดะฝะตะน ะฒะฟะตััะด.
```

**ะะฝะพะฟะบะธ (inline ะบะฐะปะตะฝะดะฐัั):**
```
      โ๏ธ ะฏะฝะฒะฐัั 2025 โถ๏ธ
ะะฝ  ะั  ะกั  ะงั  ะั  ะกะฑ  ะั
        1   2   3   4   5
 6   7   8   9  10  11  12
13  14  15  16  17  18  19
20  21  22  23  24  25  26
27  28  29  30  31

[โ๏ธ ะะฐะทะฐะด]
```

**Callback data:**
- `cal_prev` / `cal_next` โ ะฟะตัะตะบะปััะตะฝะธะต ะผะตัััะฐ
- `cal_day_2025-01-15` โ ะฒัะฑะพั ะบะพะฝะบัะตัะฝะพะน ะดะฐัั
- `back_main` โ ะฝะฐะทะฐะด

---

### 3.6 ะัะพะฑัะฐะถะตะฝะธะต ะฟัะพะณะฝะพะทะฐ

```
๐ฎ ะัะพะณะฝะพะท ะฝะฐ 11 ัะฝะฒะฐัั 2025

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ ะัะฝะฐ ะฒ ะขะตะปััะต
ะกะตะณะพะดะฝั ััะฐะฝะทะธัะฝะฐั ะัะฝะฐ ะฟัะพัะพะดะธั ัะตัะตะท ะฒะฐั 2-ะน ะดะพะผ
(ะผะฐัะตัะธะฐะปัะฝัะต ัะตััััั), ะพะฑัะฐะทัั ััะธะณะพะฝ ะบ ะฝะฐัะฐะปัะฝะพะน ะะตะฝะตัะต.

ะญัะพ ะฑะปะฐะณะพะฟัะธััะฝัะน ะดะตะฝั ะดะปั ัะธะฝะฐะฝัะพะฒัั ะดะตะป...

โฟ ะะตัะบััะธะน ะฒ ะบะฒะฐะดัะฐัััะต ะบ ะกะฐัััะฝั
ะะพะทะผะพะถะฝั ะฝะตะฑะพะปััะธะต ัะปะพะถะฝะพััะธ ะฒ ะบะพะผะผัะฝะธะบะฐัะธัั...

โ ะะฐัั ะฒ ัะตะบััะธะปะต ะบ ะฎะฟะธัะตัั
ะฅะพัะพัะฐั ัะฝะตัะณะธั ะดะปั ะฐะบัะธะฒะฝัั ะดะตะนััะฒะธะน...

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ก ะกะพะฒะตั ะดะฝั: ัะพััะตะดะพัะพัััะตัั ะฝะฐ ะฟัะฐะบัะธัะตัะบะธั ะดะตะปะฐั,
ะธะทะฑะตะณะฐะนัะต ะฒะฐะถะฝัั ะฟะตัะตะณะพะฒะพัะพะฒ ะดะพ ะพะฑะตะดะฐ.
```

**ะะฝะพะฟะบะธ:**
```
[๐ฌ ะะฐะดะฐัั ะฒะพะฟัะพั ะฟะพ ะฟัะพะณะฝะพะทั]
[๐ ะะทะฒััะธัั]
[๐ฎ ะะปะฐะฒะฝะพะต ะผะตะฝั]
```

**Callback data:**
- `ask_about_forecast:{forecast_id}` โ ะฒะพะฟัะพั ะฟะพ ััะพะผั ะฟัะพะณะฝะพะทั
- `voice_forecast:{forecast_id}` โ ะพะทะฒััะธัั
- `back_main` โ ะณะปะฐะฒะฝะพะต ะผะตะฝั

---

### 3.7 ะะธะฐะปะพะณ ั AI (ะฒะพะฟัะพัั)

**ะะตัะฒะพะต ัะพะพะฑัะตะฝะธะต ะฟะพัะปะต ะฝะฐะถะฐัะธั "ะะฐะดะฐัั ะฒะพะฟัะพั":**
```
๐ฌ ะะฐะดะฐะนัะต ะฒะฐั ะฒะพะฟัะพั

ะั ะผะพะถะตัะต ัะฟัะพัะธัั ะพ ัะตะบััะตะผ ะฟัะพะณะฝะพะทะต ะธะปะธ ััะพัะฝะธัั
ะปัะฑัะต ะฐัััะพะปะพะณะธัะตัะบะธะต ะฐัะฟะตะบัั.

ะััะฐะปะพัั ะฒะพะฟัะพัะพะฒ ัะตะณะพะดะฝั: 7/10

๐ก ะัะธะผะตัั ะฒะพะฟัะพัะพะฒ:
โข ะะฐะบ ััะพั ะฐัะฟะตะบั ะฒะปะธัะตั ะฝะฐ ะพัะฝะพัะตะฝะธั?
โข ะะพะณะดะฐ ะปัััะต ะฝะฐัะฐัั ะฝะพะฒัะน ะฟัะพะตะบั?
โข ะงัะพ ะพะทะฝะฐัะฐะตั ััะฐะฝะทะธั ะกะฐัััะฝะฐ ะฟะพ ะผะพะตะผั ะกะพะปะฝัั?

ะัะฟัะฐะฒััะต ัะตะบััะพะฒะพะต ะธะปะธ ะณะพะปะพัะพะฒะพะต ัะพะพะฑัะตะฝะธะต.
```

**ะะฝะพะฟะบะฐ:**
```
[โ๏ธ ะะฐะทะฐะด ะฒ ะผะตะฝั]
```

**ะะพัะปะต ะฟะพะปััะตะฝะธั ะพัะฒะตัะฐ ะพั AI:**
```
๐ค ะัะฒะตั ะฐัััะพะปะพะณะฐ:

[ะขะตะบัั ะพัะฒะตัะฐ ะพั AI...]

โโโโโโโโโโโโโโโโโโโโโโโโ
ะััะฐะปะพัั ะฒะพะฟัะพัะพะฒ: 6/10
```

**ะะฝะพะฟะบะธ:**
```
[๐ฌ ะัั ะฒะพะฟัะพั]    [๐ ะะทะฒััะธัั]
[๐ฎ ะะปะฐะฒะฝะพะต ะผะตะฝั]
```

---

### 3.8 ะะฐัััะพะนะบะธ ะฟะพะปัะทะพะฒะฐัะตะปั

```
โ๏ธ ะะฐัััะพะนะบะธ

โโโโโโโโโโโโโโโโโโโโโโโโ

โฐ ะัะตะผั ะฟัะพะณะฝะพะทะฐ: 09:00
   ะะถะตะดะฝะตะฒะฝัะน ะฟัะพะณะฝะพะท ะฟัะธัะพะดะธั ะฒ ััะพ ะฒัะตะผั

๐ ะฃะฒะตะดะพะผะปะตะฝะธั ะพ ััะฐะฝะทะธัะฐั: ะัะบะป
   ะัั ะฟัะธ ัะพัะฝัั ะฐัะฟะตะบัะฐั (ะพัะฑะธั 0-1ยฐ)

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ ะะฐัะธ ะดะฐะฝะฝัะต:
๐ ะะฐัะฐ ัะพะถะดะตะฝะธั: 15.03.1985, 14:30
๐ ะะตััะพ ัะพะถะดะตะฝะธั: ะะพัะบะฒะฐ
๐ ะัะพะถะธะฒะฐะฝะธะต: ะกะฐะฝะบั-ะะตัะตัะฑััะณ

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ณ ะะพะดะฟะธัะบะฐ ะฐะบัะธะฒะฝะฐ ะดะพ: 15.02.2025
```

**ะะฝะพะฟะบะธ:**
```
[โฐ ะะทะผะตะฝะธัั ะฒัะตะผั]
[๐ ะะบะป] / [๐ ะัะบะป]      โ ะฟะตัะตะบะปััะฐัะตะปั ัะฒะตะดะพะผะปะตะฝะธะน
[๐ณ ะัะพะดะปะธัั ะฟะพะดะฟะธัะบั]
[โ๏ธ ะะฐะทะฐะด]
```

**Callback data:**
- `settings_time` โ ะธะทะผะตะฝะธัั ะฒัะตะผั ะฟัะพะณะฝะพะทะฐ
- `settings_push_on` / `settings_push_off` โ ะฒะบะป/ะฒัะบะป ะฟัั
- `payment_extend` โ ะฟัะพะดะปะธัั ะฟะพะดะฟะธัะบั
- `back_main` โ ะฝะฐะทะฐะด

---

### 3.9 ะะทะผะตะฝะตะฝะธะต ะฒัะตะผะตะฝะธ ะฟัะพะณะฝะพะทะฐ

```
โฐ ะัะฑะตัะธัะต ะฒัะตะผั ะฟะพะปััะตะฝะธั ะฟัะพะณะฝะพะทะฐ:

ะัะพะณะฝะพะท ะฑัะดะตั ะฟัะธัะพะดะธัั ะบะฐะถะดัะน ะดะตะฝั ะฒ ะฒัะฑัะฐะฝะฝะพะต ะฒัะตะผั
ะฟะพ ะฒะฐัะตะผั ัะฐัะพะฒะพะผั ะฟะพััั (Europe/Moscow).
```

**ะะฝะพะฟะบะธ (ัะตัะบะฐ ะฒัะตะผะตะฝะธ):**
```
[06:00]  [07:00]  [08:00]
[09:00โ] [10:00]  [11:00]
[12:00]  [13:00]  [14:00]
[18:00]  [20:00]  [22:00]
[โ๏ธ ะะฐะทะฐะด]
```

**Callback data:** `set_time_09:00`

---

### 3.10 ะกะฟัะฐะฒะบะฐ

```
โน๏ธ ะกะฟัะฐะฒะบะฐ

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฎ ะะฐะบ ัะฐะฑะพัะฐะตั ะฑะพั?

ะะพั ะธัะฟะพะปัะทัะตั ะผะตัะพะดะพะปะพะณะธั ััะฐะฝะทะธัะฝะพะณะพ ะฐะฝะฐะปะธะทะฐ
ะก.ะ. ะจะตััะพะฟะฐะปะพะฒะฐ โ ะพะดะฝะพะณะพ ะธะท ะฒะตะดััะธั ัะพััะธะนัะบะธั ะฐัััะพะปะพะณะพะฒ.

ะขัะฐะฝะทะธัั โ ััะพ ัะตะบััะธะต ะฟะพะปะพะถะตะฝะธั ะฟะปะฐะฝะตั ะพัะฝะพัะธัะตะปัะฝะพ
ะฒะฐัะตะน ะฝะฐัะฐะปัะฝะพะน ะบะฐััั. ะะฝะธ ะฟะพะบะฐะทัะฒะฐัั ะฐะบััะฐะปัะฝัะต
ัะฝะตัะณะธะธ ะธ ัะตะฝะดะตะฝัะธะธ ะฒ ะฒะฐัะตะน ะถะธะทะฝะธ.

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ ะะพะทะผะพะถะฝะพััะธ ะฑะพัะฐ:

โข ๐ฎ ะะถะตะดะฝะตะฒะฝัะน ะฟะตััะพะฝะฐะปัะฝัะน ะฟัะพะณะฝะพะท
โข ๐ ะัะพะณะฝะพะทั ะฝะฐ ะฟะตัะธะพะด (3 ะดะฝั, ะฝะตะดะตะปั, ะผะตััั)
โข ๐ ะัะพะณะฝะพะท ะฝะฐ ะบะพะฝะบัะตัะฝัั ะดะฐัั
โข ๐ฌ ะะพ 10 ะฒะพะฟัะพัะพะฒ AI-ะฐัััะพะปะพะณั ะฒ ะดะตะฝั
โข ๐ค ะะพะปะพัะพะฒัะต ัะพะพะฑัะตะฝะธั ะธ ะพัะฒะตัั
โข ๐ ะฃะฒะตะดะพะผะปะตะฝะธั ะพ ะฒะฐะถะฝัั ััะฐะฝะทะธัะฐั

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ ะะตัะพะดะพะปะพะณะธั ะจะตััะพะฟะฐะปะพะฒะฐ

[ะะพะดัะพะฑะฝะตะต ะพ ะผะตัะพะดะต โ]
```

**ะะฝะพะฟะบะธ:**
```
[๐ ะะพะดัะพะฑะฝะตะต ะพ ะผะตัะพะดะต]
[โ๏ธ ะะฐะทะฐะด]
```

---

### 3.11 ะะพะดะดะตัะถะบะฐ

```
๐จโ๐ป ะะพะดะดะตัะถะบะฐ

ะัะปะธ ั ะฒะฐั ะตััั ะฒะพะฟัะพัั ะธะปะธ ะฟัะพะฑะปะตะผั, ะฝะฐะฟะธัะธัะต ัะพะพะฑัะตะฝะธะต โ
ะฐะดะผะธะฝะธัััะฐัะพั ะพัะฒะตัะธั ะฒ ะฑะปะธะถะฐะนัะตะต ะฒัะตะผั.

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ ะะฐัะธ ะพะฑัะฐัะตะฝะธั:

๐ข #42 โ ะะพะฟัะพั ะฟะพ ะฟะพะดะฟะธัะบะต (ะพัะฒะตั ะฟะพะปััะตะฝ)
๐ก #45 โ ะะต ะฟัะธัะพะดะธั ะฟัะพะณะฝะพะท (ะพะถะธะดะฐะตั ะพัะฒะตัะฐ)

โโโโโโโโโโโโโโโโโโโโโโโโ

ะงัะพะฑั ัะพะทะดะฐัั ะฝะพะฒะพะต ะพะฑัะฐัะตะฝะธะต, ะฟัะพััะพ ะฝะฐะฟะธัะธัะต ัะพะพะฑัะตะฝะธะต.
```

**ะะฝะพะฟะบะธ:**
```
[๐ ะะฐะฟะธัะฐัั ะฒ ะฟะพะดะดะตัะถะบั]
[๐ ะะพะธ ะพะฑัะฐัะตะฝะธั]
[โ๏ธ ะะฐะทะฐะด]
```

---

### 3.12 ะะฟะปะฐัะฐ ะฟะพะดะฟะธัะบะธ

```
๐ณ ะัะพัะผะปะตะฝะธะต ะฟะพะดะฟะธัะบะธ

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฆ ะะพะดะฟะธัะบะฐ ะฝะฐ 1 ะผะตััั

โ ะะถะตะดะฝะตะฒะฝัะต ะฟะตััะพะฝะฐะปัะฝัะต ะฟัะพะณะฝะพะทั
โ ะัะพะณะฝะพะทั ะฝะฐ ะปัะฑะพะน ะฟะตัะธะพะด
โ 10 ะฒะพะฟัะพัะพะฒ AI-ะฐัััะพะปะพะณั ะฒ ะดะตะฝั
โ ะะพะปะพัะพะฒัะต ะพัะฒะตัั
โ ะฃะฒะตะดะพะผะปะตะฝะธั ะพ ััะฐะฝะทะธัะฐั

๐ฐ ะกัะพะธะผะพััั: 990 โฝ

โโโโโโโโโโโโโโโโโโโโโโโโ

ะะฐะถะผะธัะต ะบะฝะพะฟะบั ะดะปั ะฟะตัะตัะพะดะฐ ะบ ะพะฟะปะฐัะต.
ะะพัะปะต ะพะฟะปะฐัั ะฟะพะดะฟะธัะบะฐ ะฐะบัะธะฒะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ.
```

**ะะฝะพะฟะบะธ:**
```
[๐ณ ะะฟะปะฐัะธัั 990 โฝ]
[โ๏ธ ะะฐะทะฐะด]
```

**ะะพัะปะต ัะพะทะดะฐะฝะธั ะฟะปะฐัะตะถะฐ:**
```
๐ณ ะะฟะปะฐัะฐ ะฟะพะดะฟะธัะบะธ

ะะปั ะทะฐะฒะตััะตะฝะธั ะพะฟะปะฐัั ะฟะตัะตะนะดะธัะต ะฟะพ ัััะปะบะต:

๐ [ะะตัะตะนัะธ ะบ ะพะฟะปะฐัะต]

ะะพัะปะต ััะฟะตัะฝะพะน ะพะฟะปะฐัั ะฟะพะดะฟะธัะบะฐ ะฐะบัะธะฒะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ.
ะัะปะธ ะพะฟะปะฐัะฐ ะฝะต ะฟัะพัะพะดะธั โ ะพะฑัะฐัะธัะตัั ะฒ ะฟะพะดะดะตัะถะบั.
```

**ะะฝะพะฟะบะธ:**
```
[๐ ะะตัะตะนัะธ ะบ ะพะฟะปะฐัะต]    โ URL ะบะฝะพะฟะบะฐ
[โ ะฏ ะพะฟะปะฐัะธะป]
[โ ะัะผะตะฝะฐ]
```

---

### 3.13 ะะฐะฟะพะผะธะฝะฐะฝะธั ะพ ะฟะพะดะฟะธัะบะต

**ะะฐ 3 ะดะฝั ะดะพ ะพะบะพะฝัะฐะฝะธั:**
```
โฐ ะะฐะฟะพะผะธะฝะฐะฝะธะต

ะะฐัะฐ ะฟะพะดะฟะธัะบะฐ ะทะฐะบะฐะฝัะธะฒะฐะตััั ัะตัะตะท 3 ะดะฝั (15.02.2025).

ะัะพะดะปะธัะต ะฟะพะดะฟะธัะบั, ััะพะฑั ะฟัะพะดะพะปะถะธัั ะฟะพะปััะฐัั
ะฟะตััะพะฝะฐะปัะฝัะต ะฟัะพะณะฝะพะทั.

[๐ณ ะัะพะดะปะธัั ะฟะพะดะฟะธัะบั]
[โฐ ะะฐะฟะพะผะฝะธัั ะฟะพะทะถะต]
```

**ะ ะดะตะฝั ะพะบะพะฝัะฐะฝะธั:**
```
โ๏ธ ะะพะดะฟะธัะบะฐ ะทะฐะบะฐะฝัะธะฒะฐะตััั ัะตะณะพะดะฝั!

ะงัะพะฑั ะฝะต ะฟัะพะฟัััะธัั ะทะฐะฒััะฐัะฝะธะน ะฟัะพะณะฝะพะท,
ะฟัะพะดะปะธัะต ะฟะพะดะฟะธัะบั ัะตะนัะฐั.

[๐ณ ะัะพะดะปะธัั ะฟะพะดะฟะธัะบั]
```

**ะะพัะปะต ะธััะตัะตะฝะธั:**
```
โ ะะพะดะฟะธัะบะฐ ะธััะตะบะปะฐ

ะะฐัะฐ ะฟะพะดะฟะธัะบะฐ ะทะฐะบะพะฝัะธะปะฐัั. ะัะพะณะฝะพะทั ะฟัะธะพััะฐะฝะพะฒะปะตะฝั.

ะัะพะดะปะธัะต ะฟะพะดะฟะธัะบั, ััะพะฑั ะฟัะพะดะพะปะถะธัั ะฟะพะปัะทะพะฒะฐัััั
ะฒัะตะผะธ ะฒะพะทะผะพะถะฝะพัััะผะธ ะฑะพัะฐ.

[๐ณ ะัะพะดะปะธัั ะฟะพะดะฟะธัะบั]
[๐จโ๐ป ะะพะดะดะตัะถะบะฐ]
```

---

## 4. ะะดะผะธะฝ-ะฟะฐะฝะตะปั (ะฟะพะปะฝัะน ััะฝะบัะธะพะฝะฐะป)

### 4.1 ะะปะฐะฒะฝะพะต ะผะตะฝั ะฐะดะผะธะฝะบะธ

**ะะพะผะฐะฝะดะฐ:** `/admin`

```
๐ ะะดะผะธะฝ-ะฟะฐะฝะตะปั

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ ะกัะฐัะธััะธะบะฐ:
โข ะัะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน: 87
โข ะะบัะธะฒะฝัั ะฟะพะดะฟะธัะพะบ: 42
โข ะััะตะบะฐะตั ะฒ 3 ะดะฝั: 5
โข ะััะตะบัะธั: 12
โข ะะตะท ะดะฐะฝะฝัั: 28

๐ฐ ะััััะบะฐ: 41 580 โฝ (ะฒัะตะณะพ)

โโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะฝะพะฟะบะธ (2 ะบะพะปะพะฝะบะธ):**
```
[๐ฅ ะะพะปัะทะพะฒะฐัะตะปะธ]        [๐ ะกัะฐัะธััะธะบะฐ]
[๐ข ะะฐัััะปะบะฐ]            [๐ฌ ะะพะดะดะตัะถะบะฐ (3)]
[โ ะะพะฑะฐะฒะธัั ะบะปะธะตะฝัะฐ]
[โ ะะฐะบัััั]
```

**Callback data:**
- `adm_users` โ ัะฟะธัะพะบ ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- `adm_stats` โ ะดะตัะฐะปัะฝะฐั ััะฐัะธััะธะบะฐ
- `adm_broadcast` โ ัะฐัััะปะบะฐ
- `adm_support` โ ัะธะบะตัั ะฟะพะดะดะตัะถะบะธ
- `adm_add_user` โ ะดะพะฑะฐะฒะธัั ะบะปะธะตะฝัะฐ
- `adm_close` โ ะทะฐะบัััั ะฟะฐะฝะตะปั

---

### 4.2 ะกะฟะธัะพะบ ะฟะพะปัะทะพะฒะฐัะตะปะตะน

```
๐ฅ ะะพะปัะทะพะฒะฐัะตะปะธ

๐ ะะพะธัะบ: ะพัะฟัะฐะฒััะต ะธะผั, @username ะธะปะธ ID

โโโโโโโโโโโโโโโโโโโโโโโโ

ะคะธะปััั: ะัะต (87)
```

**ะะฝะพะฟะบะธ (ัะธะปัััั):**
```
[ะัะต (87)]  [โ ะะบัะธะฒะฝัะต (42)]  [โ ะัััะบัะธะต (12)]
[โฐ ะััะตะบะฐัั (5)]  [โ๏ธ ะะตะท ะดะฐะฝะฝัั (28)]

โโโโโโโโโโโโโโโโโโโโโโโโ

ะะฒะฐะฝ ะะฒะฐะฝะพะฒ โ โ ะดะพ 15.02
ะะฐัะธั ะะตััะพะฒะฐ โ โ ะดะพ 20.02
ะะปะตะบัะตะน ะกะธะดะพัะพะฒ โ โ ะธััะตะบะปะฐ
ะะปะตะฝะฐ ะะพะทะปะพะฒะฐ โ โ๏ธ ะฝะตั ะดะฐะฝะฝัั
...

[1] [2] [3] [โถ๏ธ]           โ ะฟะฐะณะธะฝะฐัะธั

[โ๏ธ ะะฐะทะฐะด]
```

**Callback data:**
- `adm_users_filter_all` โ ะฒัะต
- `adm_users_filter_active` โ ะฐะบัะธะฒะฝัะต
- `adm_users_filter_expired` โ ะธัััะบัะธะต
- `adm_users_filter_expiring` โ ะธััะตะบะฐััะธะต
- `adm_users_filter_nodata` โ ะฑะตะท ะดะฐะฝะฝัั
- `adm_user_{id}` โ ะบะฐััะพัะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
- `adm_users_page_{n}` โ ะฟะฐะณะธะฝะฐัะธั

---

### 4.3 ะะฐััะพัะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั (ะดะปั ะฐะดะผะธะฝะฐ)

```
๐ค ะะฒะฐะฝ ะะฒะฐะฝะพะฒ

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฑ Telegram: @ivanov (ID: 123456789)
๐ ะะฐัะตะณะธัััะธัะพะฒะฐะฝ: 10.01.2025

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฎ ะะฐัะฐะปัะฝัะต ะดะฐะฝะฝัะต:
๐ ะะพะถะดะตะฝะธะต: 15.03.1985, 14:30
๐ ะะตััะพ ัะพะถะดะตะฝะธั: ะะพัะบะฒะฐ (55.7558, 37.6173)
๐ ะัะพะถะธะฒะฐะฝะธะต: ะกะฐะฝะบั-ะะตัะตัะฑััะณ (59.9343, 30.3351)
๐ ะงะฐัะพะฒะพะน ะฟะพัั: Europe/Moscow

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ณ ะะพะดะฟะธัะบะฐ: โ ะะบัะธะฒะฝะฐ ะดะพ 15.02.2025
๐ฐ ะัะตะณะพ ะพะฟะปะฐัะตะฝะพ: 1 980 โฝ

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ ะะบัะธะฒะฝะพััั:
โข ะะพะฟัะพัะพะฒ ัะตะณะพะดะฝั: 3/10
โข ะัะตะณะพ ะฟัะพะณะฝะพะทะพะฒ: 25
โข ะะพัะปะตะดะฝะธะน ะฒัะพะด: ัะตะณะพะดะฝั, 10:45
```

**ะะฝะพะฟะบะธ:**
```
[โ๏ธ ะะตะดะฐะบัะธัะพะฒะฐัั ะดะฐะฝะฝัะต]
[๐ณ ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะดะฟะธัะบะพะน โ]
[๐จ ะะฐะฟะธัะฐัั ะฟะพะปัะทะพะฒะฐัะตะปั]
[๐ฎ ะัะฟัะฐะฒะธัั ะฟัะพะณะฝะพะท ัะตะนัะฐั]
[๐ ะััะพัะธั ะฟัะพะณะฝะพะทะพะฒ]
[๐ ะฃะดะฐะปะธัั ะฟะพะปัะทะพะฒะฐัะตะปั]
[โ๏ธ ะ ัะฟะธัะบั]
```

**Callback data:**
- `adm_edit_user_{id}` โ ัะตะดะฐะบัะธัะพะฒะฐัั
- `adm_sub_{id}` โ ัะฟัะฐะฒะปะตะฝะธะต ะฟะพะดะฟะธัะบะพะน
- `adm_msg_{id}` โ ะฝะฐะฟะธัะฐัั
- `adm_send_forecast_{id}` โ ะพัะฟัะฐะฒะธัั ะฟัะพะณะฝะพะท
- `adm_history_{id}` โ ะธััะพัะธั
- `adm_delete_{id}` โ ัะดะฐะปะธัั
- `adm_users` โ ะบ ัะฟะธัะบั

---

### 4.4 ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปั

```
โ๏ธ ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต: ะะฒะฐะฝ ะะฒะฐะฝะพะฒ

ะัะฑะตัะธัะต, ััะพ ะธะทะผะตะฝะธัั:
```

**ะะฝะพะฟะบะธ:**
```
[๐ ะะฐัะฐ ัะพะถะดะตะฝะธั: 15.03.1985]
[โฐ ะัะตะผั ัะพะถะดะตะฝะธั: 14:30]
[๐ ะะตััะพ ัะพะถะดะตะฝะธั: ะะพัะบะฒะฐ]
[๐ ะะตััะพ ะฟัะพะถะธะฒะฐะฝะธั: ะกะะฑ]
[๐ค ะะผั: ะะฒะฐะฝ ะะฒะฐะฝะพะฒ]
[โ๏ธ ะะฐะทะฐะด ะบ ะฟัะพัะธะปั]
```

ะะพัะปะต ะฒัะฑะพัะฐ ะฟะพะปั โ FSM ัะตะถะธะผ ะฒะฒะพะดะฐ:

```
๐ ะะฒะตะดะธัะต ะฝะพะฒัั ะดะฐัั ัะพะถะดะตะฝะธั

ะคะพัะผะฐั: ะะ.ะะ.ะะะะ
ะัะธะผะตั: 15.03.1985

ะขะตะบััะตะต ะทะฝะฐัะตะฝะธะต: 15.03.1985
```

**ะะฝะพะฟะบะฐ:**
```
[โ ะัะผะตะฝะฐ]
```

---

### 4.5 ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะพะดะฟะธัะบะพะน

```
๐ณ ะะพะดะฟะธัะบะฐ: ะะฒะฐะฝ ะะฒะฐะฝะพะฒ

ะขะตะบััะธะน ััะฐััั: โ ะะบัะธะฒะฝะฐ
ะะตะนััะฒัะตั ะดะพ: 15.02.2025
ะััะฐะปะพัั ะดะฝะตะน: 35
```

**ะะฝะพะฟะบะธ:**
```
[โ ะัะพะดะปะธัั ะฝะฐ 30 ะดะฝะตะน]
[๐ ะฃััะฐะฝะพะฒะธัั ะดะฐัั ะพะบะพะฝัะฐะฝะธั]
[๐ ะะบัะธะฒะธัะพะฒะฐัั ะฑะตัะฟะปะฐัะฝะพ]
[โ ะัะผะตะฝะธัั ะฟะพะดะฟะธัะบั]
[โ๏ธ ะะฐะทะฐะด ะบ ะฟัะพัะธะปั]
```

**Callback data:**
- `adm_sub_extend_{id}` โ ะฟัะพะดะปะธัั
- `adm_sub_set_date_{id}` โ ัััะฐะฝะพะฒะธัั ะดะฐัั
- `adm_sub_free_{id}` โ ะฑะตัะฟะปะฐัะฝะฐั ะฐะบัะธะฒะฐัะธั
- `adm_sub_cancel_{id}` โ ะพัะผะตะฝะธัั

---

### 4.6 ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะบะปะธะตะฝัะฐ (ะฒะธะทะฐัะด)

**ะจะฐะณ 1: Telegram ID**
```
โ ะะพะฑะฐะฒะปะตะฝะธะต ะบะปะธะตะฝัะฐ

ะจะฐะณ 1 ะธะท 6: ะะดะตะฝัะธัะธะบะฐัะธั

ะะฒะตะดะธัะต Telegram ID ะธะปะธ @username ะฝะพะฒะพะณะพ ะบะปะธะตะฝัะฐ.

๐ก ะะพะฟัะพัะธัะต ะบะปะธะตะฝัะฐ ะฝะฐะฟะธัะฐัั ะฑะพัั /start,
   ััะพะฑั ะฟะพะปััะธัั ะตะณะพ ID ะฐะฒัะพะผะฐัะธัะตัะบะธ.

ะะปะธ ะฒะฒะตะดะธัะต ID ะฒัััะฝัั (ะฝะฐะฟัะธะผะตั: 123456789)
```

**ะจะฐะณ 2: ะะผั**
```
โ ะะพะฑะฐะฒะปะตะฝะธะต ะบะปะธะตะฝัะฐ

ะจะฐะณ 2 ะธะท 6: ะะผั

ะะฒะตะดะธัะต ะธะผั ะบะปะธะตะฝัะฐ (ะบะฐะบ ะพะฑัะฐัะฐัััั ะฒ ะฟัะพะณะฝะพะทะฐั).

ะัะธะผะตั: ะะฒะฐะฝ ะะฒะฐะฝะพะฒ
```

**ะจะฐะณ 3: ะะฐัะฐ ัะพะถะดะตะฝะธั**
```
โ ะะพะฑะฐะฒะปะตะฝะธะต ะบะปะธะตะฝัะฐ

ะจะฐะณ 3 ะธะท 6: ะะฐัะฐ ัะพะถะดะตะฝะธั

ะะฒะตะดะธัะต ะดะฐัั ัะพะถะดะตะฝะธั.

ะคะพัะผะฐั: ะะ.ะะ.ะะะะ
ะัะธะผะตั: 15.03.1985
```

**ะจะฐะณ 4: ะัะตะผั ัะพะถะดะตะฝะธั**
```
โ ะะพะฑะฐะฒะปะตะฝะธะต ะบะปะธะตะฝัะฐ

ะจะฐะณ 4 ะธะท 6: ะัะตะผั ัะพะถะดะตะฝะธั

ะะฒะตะดะธัะต ัะพัะฝะพะต ะฒัะตะผั ัะพะถะดะตะฝะธั.

ะคะพัะผะฐั: ะงะง:ะะ
ะัะธะผะตั: 14:30

โ๏ธ ะขะพัะฝะพััั ะฒัะตะผะตะฝะธ ะบัะธัะธัะฝะฐ ะดะปั ัะฐััััะฐ ะดะพะผะพะฒ!
```

**ะจะฐะณ 5: ะะตััะพ ัะพะถะดะตะฝะธั**
```
โ ะะพะฑะฐะฒะปะตะฝะธะต ะบะปะธะตะฝัะฐ

ะจะฐะณ 5 ะธะท 6: ะะตััะพ ัะพะถะดะตะฝะธั

ะะฒะตะดะธัะต ะณะพัะพะด ัะพะถะดะตะฝะธั.

ะัะธะผะตั: ะะพัะบะฒะฐ

ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฟัะตะดะตะปะธั ะบะพะพัะดะธะฝะฐัั.
```

ะะพัะปะต ะฒะฒะพะดะฐ ะณะพัะพะดะฐ โ ะฟะพะดัะฒะตัะถะดะตะฝะธะต:
```
๐ ะะฐะนะดะตะฝ ะณะพัะพะด:

ะะพัะบะฒะฐ, ะะพััะธั
ะะพะพัะดะธะฝะฐัั: 55.7558ยฐN, 37.6173ยฐE
ะงะฐัะพะฒะพะน ะฟะพัั: Europe/Moscow

ะญัะพ ะฟัะฐะฒะธะปัะฝัะน ะณะพัะพะด?
```

**ะะฝะพะฟะบะธ:**
```
[โ ะะฐ, ะฒะตัะฝะพ]    [๐ ะัะบะฐัั ะดััะณะพะน]
```

**ะจะฐะณ 6: ะะตััะพ ะฟัะพะถะธะฒะฐะฝะธั**
```
โ ะะพะฑะฐะฒะปะตะฝะธะต ะบะปะธะตะฝัะฐ

ะจะฐะณ 6 ะธะท 6: ะะตััะพ ะฟัะพะถะธะฒะฐะฝะธั

ะะฒะตะดะธัะต ัะตะบััะธะน ะณะพัะพะด ะฟัะพะถะธะฒะฐะฝะธั.

๐ก ะญัะพ ะฒะฐะถะฝะพ ะดะปั ัะฐััััะฐ ะดะพะผะพะฒ ะฝะฐ ะผะพะผะตะฝั ะฟัะพะณะฝะพะทะฐ.

ะัะธะผะตั: ะกะฐะฝะบั-ะะตัะตัะฑััะณ
```

**ะะพะดัะฒะตัะถะดะตะฝะธะต:**
```
โ ะัะพะฒะตัััะต ะดะฐะฝะฝัะต ะบะปะธะตะฝัะฐ:

๐ค ะะฒะฐะฝ ะะฒะฐะฝะพะฒ
๐ฑ Telegram ID: 123456789

๐ ะะพะถะดะตะฝะธะต: 15.03.1985, 14:30
๐ ะะตััะพ ัะพะถะดะตะฝะธั: ะะพัะบะฒะฐ (55.7558, 37.6173)
๐ ะัะพะถะธะฒะฐะฝะธะต: ะกะฐะฝะบั-ะะตัะตัะฑััะณ (59.9343, 30.3351)

ะัั ะฒะตัะฝะพ?
```

**ะะฝะพะฟะบะธ:**
```
[โ ะกะพััะฐะฝะธัั]    [โ๏ธ ะะตะดะฐะบัะธัะพะฒะฐัั]    [โ ะัะผะตะฝะฐ]
```

---

### 4.7 ะะตัะฐะปัะฝะฐั ััะฐัะธััะธะบะฐ

```
๐ ะกัะฐัะธััะธะบะฐ

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฅ ะะพะปัะทะพะฒะฐัะตะปะธ:
โข ะัะตะณะพ: 87
โข ะก ะฝะฐัะฐะปัะฝัะผะธ ะดะฐะฝะฝัะผะธ: 59
โข ะะตะท ะดะฐะฝะฝัั: 28

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ณ ะะพะดะฟะธัะบะธ:
โข ะะบัะธะฒะฝัั: 42 (48%)
โข ะััะตะบะฐะตั ะฒ 3 ะดะฝั: 5
โข ะััะตะบัะธั: 12
โข ะะถะธะดะฐัั ะพะฟะปะฐัั: 3

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฐ ะคะธะฝะฐะฝัั:
โข ะะฐ ััะพั ะผะตััั: 8 910 โฝ (9 ะพะฟะปะฐั)
โข ะะฐ ะฟัะพัะปัะน ะผะตััั: 12 870 โฝ (13 ะพะฟะปะฐั)
โข ะัะตะณะพ: 41 580 โฝ

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฎ ะัะพะณะฝะพะทั:
โข ะกะตะณะพะดะฝั ะพัะฟัะฐะฒะปะตะฝะพ: 42
โข ะะฐ ะฝะตะดะตะปั: 294
โข ะัะตะณะพ: 1 247

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฌ ะะพะฟัะพัั AI:
โข ะกะตะณะพะดะฝั: 67
โข ะะฐ ะฝะตะดะตะปั: 423
โข ะกัะตะดะฝะตะต ะฒ ะดะตะฝั: 60
```

**ะะฝะพะฟะบะธ:**
```
[๐ ะัะฐัะธะบ ะฟะพ ะผะตัััะฐะผ]
[๐ฅ ะัะณััะทะธัั ะฒ CSV]
[โ๏ธ ะะฐะทะฐะด]
```

---

### 4.8 ะะฐัััะปะบะฐ

```
๐ข ะะฐัััะปะบะฐ

ะกะพะทะดะฐะนัะต ัะพะพะฑัะตะฝะธะต ะดะปั ะพัะฟัะฐะฒะบะธ ะฟะพะปัะทะพะฒะฐัะตะปัะผ.
```

**ะะฝะพะฟะบะธ (ะฒัะฑะพั ะฐัะดะธัะพัะธะธ):**
```
[๐ฅ ะัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ (87)]
[โ ะขะพะปัะบะพ ั ะฐะบัะธะฒะฝะพะน ะฟะพะดะฟะธัะบะพะน (42)]
[โ ะขะพะปัะบะพ ั ะธัััะบัะตะน ะฟะพะดะฟะธัะบะพะน (12)]
[โฐ ะะพะดะฟะธัะบะฐ ะธััะตะบะฐะตั ัะบะพัะพ (5)]
[โ๏ธ ะะฐะทะฐะด]
```

ะะพัะปะต ะฒัะฑะพัะฐ:
```
๐ข ะะฐัััะปะบะฐ

ะัะดะธัะพัะธั: โ ะะบัะธะฒะฝัะต ะฟะพะดะฟะธัะบะธ (42 ัะตะป.)

ะะฒะตะดะธัะต ัะตะบัั ัะพะพะฑัะตะฝะธั.

๐ก ะะพะดะดะตัะถะธะฒะฐะตััั HTML-ัะพัะผะฐัะธัะพะฒะฐะฝะธะต:
<b>ะถะธัะฝัะน</b>, <i>ะบัััะธะฒ</i>, <code>ะบะพะด</code>

ะะพะถะฝะพ ะฟัะธะบัะตะฟะธัั ัะพัะพ ะบ ัะพะพะฑัะตะฝะธั.
```

ะัะตะดะฟัะพัะผะพัั:
```
๐ข ะัะตะดะฟัะพัะผะพัั ัะฐัััะปะบะธ

โโโโโโโโโโโโโโโโโโโโโโโโ

[ะขะตะบัั ัะพะพะฑัะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปั...]

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฅ ะะพะปััะฐัะตะปะธ: 42 ะฟะพะปัะทะพะฒะฐัะตะปั
๐ ะะปะพะถะตะฝะธั: ะฝะตั
```

**ะะฝะพะฟะบะธ:**
```
[โ ะัะฟัะฐะฒะธัั]    [โ๏ธ ะะตะดะฐะบัะธัะพะฒะฐัั]    [โ ะัะผะตะฝะฐ]
```

ะะตะทัะปััะฐั:
```
โ ะะฐัััะปะบะฐ ะทะฐะฒะตััะตะฝะฐ

๐ ะกัะฐัะธััะธะบะฐ:
โข ะัะฟัะฐะฒะปะตะฝะพ: 40
โข ะัะธะฑะพะบ: 2 (ะทะฐะฑะปะพะบะธัะพะฒะฐะปะธ ะฑะพัะฐ)

ะัะตะผั ะพัะฟัะฐะฒะบะธ: 12 ัะตะบัะฝะด
```

---

### 4.9 ะะพะดะดะตัะถะบะฐ (ะดะปั ะฐะดะผะธะฝะฐ)

```
๐ฌ ะะฑัะฐัะตะฝะธั ะฒ ะฟะพะดะดะตัะถะบั

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ด ะะพะฒัะต (3):

#47 โ ะะฒะฐะฝ ะะฒะฐะฝะพะฒ (2 ะผะธะฝ. ะฝะฐะทะฐะด)
   "ะะต ะฟัะธัะพะดะธั ะตะถะตะดะฝะตะฒะฝัะน ะฟัะพะณะฝะพะท..."

#46 โ ะะฐัะธั ะะตััะพะฒะฐ (15 ะผะธะฝ. ะฝะฐะทะฐะด)
   "ะะฐะบ ะธะทะผะตะฝะธัั ะฒัะตะผั ะฟะพะปััะตะฝะธั..."

#45 โ ะะปะตะบัะตะน ะก. (1 ัะฐั ะฝะฐะทะฐะด)
   "ะะฟะปะฐัะธะป ะฝะพ ะฟะพะดะฟะธัะบะฐ ะฝะต ะฐะบัะธะฒะฝะฐ..."

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ก ะะถะธะดะฐัั ะพัะฒะตัะฐ (2):
...

๐ข ะะฐะบััััะต (12):
...
```

**ะะฝะพะฟะบะธ:**
```
[๐ด ะะพะฒัะต (3)]    [๐ก ะ ัะฐะฑะพัะต (2)]    [๐ข ะะฐะบััััะต]
[โ๏ธ ะะฐะทะฐะด]
```

**ะะฐััะพัะบะฐ ัะธะบะตัะฐ:**
```
๐ฌ ะขะธะบะตั #47

๐ค ะะฒะฐะฝ ะะฒะฐะฝะพะฒ (@ivanov)
๐ ะกะพะทะดะฐะฝ: 11.01.2025, 14:30
๐ ะกัะฐััั: ๐ด ะะพะฒัะน

โโโโโโโโโโโโโโโโโโโโโโโโ

๐ฌ ะกะพะพะฑัะตะฝะธั:

[14:30] ะะพะปัะทะพะฒะฐัะตะปั:
ะะต ะฟัะธัะพะดะธั ะตะถะตะดะฝะตะฒะฝัะน ะฟัะพะณะฝะพะท, ัะพัั ะฟะพะดะฟะธัะบะฐ ะฐะบัะธะฒะฝะฐ.
ะัะตะผั ะฟัะพะณะฝะพะทะฐ ััะพะธั 09:00.

โโโโโโโโโโโโโโโโโโโโโโโโ

ะงัะพะฑั ะพัะฒะตัะธัั, ะพัะฟัะฐะฒััะต ัะพะพะฑัะตะฝะธะต.
```

**ะะฝะพะฟะบะธ:**
```
[๐ค ะัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั]
[โ ะะฐะบัััั ัะธะบะตั]
[โ๏ธ ะ ัะฟะธัะบั]
```

---

## 5. ะกะธััะตะผะฝัะต ะฟัะพัะตััั

### 5.1 ะะปะฐะฝะธัะพะฒัะธะบ ะตะถะตะดะฝะตะฒะฝัั ะฟัะพะณะฝะพะทะพะฒ (APScheduler)

```python
# ะัะพะฒะตัะบะฐ ะบะฐะถะดัั ะผะธะฝััั
@scheduler.scheduled_job('cron', minute='*')
async def check_forecast_time():
    """ะัะพะฒะตััะตั, ะบะพะผั ะฟะพัะฐ ะพัะฟัะฐะฒะปััั ะฟัะพะณะฝะพะท"""
    now = datetime.now()
    current_time = now.strftime("%H:%M")

    # ะะฐัะพะดะธะผ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ั ะฐะบัะธะฒะฝะพะน ะฟะพะดะฟะธัะบะพะน ะธ ะฝัะถะฝัะผ ะฒัะตะผะตะฝะตะผ
    users = User.select().where(
        User.natal_data_complete == True,
        User.forecast_time == current_time
    )

    for user in users:
        if user.has_active_subscription():
            await generate_and_send_forecast(user, "daily")
```

### 5.2 ะัะพะฒะตัะบะฐ ะฟะพะดะฟะธัะพะบ

```python
# ะะถะตะดะฝะตะฒะฝะพ ะฒ 10:00
@scheduler.scheduled_job('cron', hour=10)
async def check_subscriptions():
    """ะะฐะฟะพะผะธะฝะฐะฝะธั ะธ ะพะฑะฝะพะฒะปะตะฝะธะต ััะฐัััะพะฒ"""
    today = date.today()

    # ะะฐ 3 ะดะฝั ะดะพ ะพะบะพะฝัะฐะฝะธั
    expiring_3d = Subscription.select().where(
        Subscription.expires_at == today + timedelta(days=3)
    )
    for sub in expiring_3d:
        await send_reminder(sub.user, days_left=3)

    # ะ ะดะตะฝั ะพะบะพะฝัะฐะฝะธั
    expiring_today = ...

    # ะัััะบัะธะต โ ะพะฑะฝะพะฒะธัั ััะฐััั
    expired = ...
```

### 5.3 Webhook YooKassa

```python
@app.on_message(filters.regex(r"^/webhook_yookassa"))
async def yookassa_webhook(request):
    """ะะฑัะฐะฑะพัะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน ะพะฑ ะพะฟะปะฐัะต"""
    # ะัะพะฒะตัะบะฐ ะฟะพะดะฟะธัะธ
    # ะะฑะฝะพะฒะปะตะฝะธะต ะฟะพะดะฟะธัะบะธ
    # ะฃะฒะตะดะพะผะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั
    # ะฃะฒะตะดะพะผะปะตะฝะธะต ะฐะดะผะธะฝะฐ
```

---

## 6. ะขะตัะฝะธัะตัะบะธะต ััะตะฑะพะฒะฐะฝะธั

### 6.1 ะะธะฑะปะธะพัะตะบะธ

```
pyrofork>=2.3.0          # Telegram API
tgcrypto                 # ะจะธััะพะฒะฐะฝะธะต
peewee>=3.17.0           # ORM
aiohttp>=3.9.0           # HTTP ะบะปะธะตะฝั
apscheduler>=3.10.0      # ะะปะฐะฝะธัะพะฒัะธะบ
pyswisseph>=2.10.0       # Swiss Ephemeris
groq>=0.4.0              # Groq API
edge-tts>=6.1.0          # Text-to-Speech
python-dotenv            # ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
pytz                     # ะงะฐัะพะฒัะต ะฟะพััะฐ
timezonefinder           # ะะฟัะตะดะตะปะตะฝะธะต TZ ะฟะพ ะบะพะพัะดะธะฝะฐัะฐะผ
geopy                    # ะะตะพะบะพะดะธะฝะณ
yookassa>=3.0.0          # ะะปะฐัะตะถะธ
```

### 6.2 ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (.env)

```
# Telegram
BOT_TOKEN=
API_ID=
API_HASH=
ADMIN_ID=

# Groq
GROQ_API_KEY=

# YooKassa
YOOKASSA_SHOP_ID=
YOOKASSA_SECRET_KEY=

# ะะฐะทะฐ ะดะฐะฝะฝัั
DB_PATH=astro_bot.sqlite

# ะฆะตะฝั
SUBSCRIPTION_PRICE=990
SUBSCRIPTION_DAYS=30
```

---

## 7. ะะตัะธัะธะบะฐัะธั (ัะตะบ-ะปะธัั MVP)

- [ ] ะะดะผะธะฝ ะผะพะถะตั ะดะพะฑะฐะฒะธัั ะฟะพะปัะทะพะฒะฐัะตะปั ั ะฝะฐัะฐะปัะฝัะผะธ ะดะฐะฝะฝัะผะธ
- [ ] ะะพะปัะทะพะฒะฐัะตะปั ะฒะธะดะธั ะณะปะฐะฒะฝะพะต ะผะตะฝั ั ะบะฝะพะฟะบะฐะผะธ
- [ ] ะะพะปัะทะพะฒะฐัะตะปั ะฟะพะปััะฐะตั ะตะถะตะดะฝะตะฒะฝัะน ะฟัะพะณะฝะพะท ะฒ ะทะฐะดะฐะฝะฝะพะต ะฒัะตะผั
- [ ] ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะทะฐะฟัะพัะธัั ะฟัะพะณะฝะพะท ะฝะฐ ัะตะณะพะดะฝั/ะฟะตัะธะพะด/ะดะฐัั
- [ ] ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะทะฐะดะฐัั ะฒะพะฟัะพั AI (ะดะพ 10 ะฒ ะดะตะฝั)
- [ ] ะะพะปะพัะพะฒัะต ัะพะพะฑัะตะฝะธั ัะฐัะฟะพะทะฝะฐัััั ะธ ะพะฑัะฐะฑะฐััะฒะฐัััั
- [ ] ะัะฒะตัั ะพะทะฒััะธะฒะฐัััั ะฟะพ ะบะฝะพะฟะบะต
- [ ] ะะฟะปะฐัะฐ ัะตัะตะท YooKassa ัะฐะฑะพัะฐะตั
- [ ] ะะฐะฟะพะผะธะฝะฐะฝะธั ะพ ะฟัะพะดะปะตะฝะธะธ ะพัะฟัะฐะฒะปััััั
- [ ] ะะพะดะดะตัะถะบะฐ โ ัะพะพะฑัะตะฝะธั ะดะพัะพะดัั ะดะพ ะฐะดะผะธะฝะฐ ะธ ะพะฑัะฐัะฝะพ
- [ ] ะะฐัััะปะบะฐ ัะฐะฑะพัะฐะตั ั ัะธะปัััะฐะผะธ ะฐัะดะธัะพัะธะธ
- [ ] ะกัะฐัะธััะธะบะฐ ะพัะพะฑัะฐะถะฐะตััั ะบะพััะตะบัะฝะพ

---

## 8. ะะพััะดะพะบ ัะฐะทัะฐะฑะพัะบะธ

1. **ะคะฐะทะฐ 1: ะกะบะตะปะตั**
   - config.py, database/models.py
   - main.py ั ัะตะณะธัััะฐัะธะตะน handlers
   - ะะฐะทะพะฒัะต keyboards.py

2. **ะคะฐะทะฐ 2: ะะดะผะธะฝะบะฐ**
   - handlers/admin.py
   - ะะพะฑะฐะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน
   - ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั

3. **ะคะฐะทะฐ 3: ะัััะพ-ะดะฒะธะถะพะบ**
   - services/astro_engine.py (Swiss Ephemeris)
   - ะะฐัััั ััะฐะฝะทะธัะพะฒ, ะฐัะฟะตะบัะพะฒ

4. **ะคะฐะทะฐ 4: AI ะณะตะฝะตัะฐัะธั**
   - services/groq_client.py
   - ะัะพะผะฟั ั ัะพัะผัะปะฐะผะธ ะจะตััะพะฟะฐะปะพะฒะฐ
   - handlers/forecast.py

5. **ะคะฐะทะฐ 5: ะะพะปัะทะพะฒะฐัะตะปััะบะธะน ะธะฝัะตััะตะนั**
   - handlers/start.py (ะณะปะฐะฒะฝะพะต ะผะตะฝั)
   - handlers/settings.py
   - handlers/questions.py

6. **ะคะฐะทะฐ 6: ะะพะปะพั**
   - services/whisper_service.py
   - services/tts_service.py
   - handlers/voice.py

7. **ะคะฐะทะฐ 7: ะะปะฐัะตะถะธ**
   - services/yookassa_service.py
   - handlers/payment.py

8. **ะคะฐะทะฐ 8: ะะปะฐะฝะธัะพะฒัะธะบ**
   - services/scheduler.py
   - ะะถะตะดะฝะตะฒะฝะฐั ัะฐัััะปะบะฐ
   - ะัะพะฒะตัะบะฐ ะฟะพะดะฟะธัะพะบ

9. **ะคะฐะทะฐ 9: ะะพะดะดะตัะถะบะฐ ะธ ัะฐัััะปะบะฐ**
   - handlers/support.py
   - ะะฐัััะปะบะฐ ะฒ admin.py

10. **ะคะฐะทะฐ 10: ะขะตััะธัะพะฒะฐะฝะธะต ะธ ะดะตะฟะปะพะน**
